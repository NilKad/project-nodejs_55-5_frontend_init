name: Build and deploy to GitHub Pages

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v2.3.1

      - name: Install, lint, build 🔧
        run: |
          npm install
          npm run lint:js
          npm run build

      - name: Deploy 🚀
        uses: JamesIves/github-pages-deploy-action@4.1.0
        with:
          branch: gh-pages
          folder: build

        # Setup key
        - run: set -eu
        - run: mkdir "$HOME/.ssh"
        - run: echo "${{ secrets.key }}" > "$HOME/.ssh/key"
        - run: chmod 600 "$HOME/.ssh/key"
        # Deploy
        - run: cd app && rsync -e "ssh -p 22 -i $HOME/.ssh/key -o StrictHostKeyChecking=no" --archive --compress --delete . mymcicu@petly.mymc.icu.:/home/mymcicu/repositories/project-nodejs_55-5_frontend

      # - name: Deploy to Server
        # uses: easingthemes/ssh-deploy@main
        # env:
          # SSH_PRIVATE_KEY: ${{secrets.SSH_PRIVATE_KEY}}
          # SSH_KNOWN_HOSTS: ${{secrets.SSH_KNOWN_HOSTS}}
          # SSH_KEY_PATH: ${{ github.workspace }}/../private.key
          
          # SSH_PRIVATE_KEY: ${{ petly.mymc.icu }}
          # ARGS: '-rlgoDzvc -i --delete'
          # SOURCE: 'dist/'
          # REMOTE_HOST: ${{ petly.mymc.icu }}
          # # REMOTE_USER: ${{ secrets.REMOTE_USER }}
          # TARGET: ${{ repositories/project-nodejs_55-5_frontend }}
          # EXCLUDE: '/dist/, /node_modules/'
